var yodel;(()=>{"use strict";var e={787:function(e,t){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.APIConnectionError=t.YodelError=t.ReservedValue=t.UnkownGroup=t.InvalidFieldArgs=void 0;var o=function(e){function t(t){var r=this;return(r=t?e.call(this,"Invalid Field Arguments: Must specify bytes, min/max, or arguments.")||this:e.call(this,"Invalid Field Arguments: Cannot create bit-lookup for Field object not of type 'flags'.")||this).name="InvalidFieldArgs",r}return n(t,e),t}(Error);t.InvalidFieldArgs=o;var i=function(e){function t(t){var r=e.call(this,"Cannot leave group '"+t+"' because this YodelSocket is not a part of group '"+t+"'")||this;return r.name="UnkownGroup",r}return n(t,e),t}(Error);t.UnkownGroup=i;var a=function(e){function t(t,r){var n=e.call(this,"Invalid use of reserved value ["+t+"] in assignment to '"+r+"'.")||this;return n.name="ReservedValue",n}return n(t,e),t}(Error);t.ReservedValue=a;var s=function(e){function t(t,r){var n=e.call(this,t)||this;return n.name=r,n}return n(t,e),t}(Error);t.YodelError=s;var c=function(e){function t(t){var r=this;switch(t){case WebSocket.CONNECTING:r=e.call(this,"This Yodel Socket has not yet connected to the API remote.")||this;break;case WebSocket.CLOSED:r=e.call(this,"This Yodel Socket has lost connection to the API remote.")||this;break;case WebSocket.CLOSING:r=e.call(this,"This Yodel Socket is closing connection to the API remote.")||this;break;default:r=e.call(this,"This Yodel Socket does not have a connection to the API remote.")||this}return r}return n(t,e),t}(Error);t.APIConnectionError=c},462:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Field=t.FieldType=void 0;var n=r(787),o=function(){function e(){}return e.int=0,e.str=1,e.bytearray=2,e.flags=3,e}();t.FieldType=o;t.Field=function(e,t,r,i,a,s){if(void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=[]),this.min=0,this.max=0,this.args=[],this.name=e,this.type=t,this.bytes=r,this.min=i,this.max=a,this.args=s,r+i+a==0)throw new n.InvalidFieldArgs(!0);if(s.length>0&&t!=o.flags)throw new n.InvalidFieldArgs(!1)}},909:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Format=void 0;var n=r(787);t.Format=function(e,t){if(void 0===t&&(t=0),this.mtype=0,this.fields=e,-127==t)throw new n.ReservedValue("-127","mtype");if(t<-127||t>127)throw new RangeError("Cannot assign value ("+t+") to 'mtype' taking range: [-127:127, !0]");if(0==t)throw new n.ReservedValue("0","mtype");this.mtype=t}},324:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.AudioGrabber=void 0;var i=r(543),a=function(e){function t(){var t=e.call(this)||this;t.mediaRecorder=void 0,t.tasklist=[];var r=t;return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){r.mediaRecorder=new MediaRecorder(e),r.mediaRecorder.addEventListener("start",(function(){r.tasklist.forEach((function(e){if(null==r.mediaRecorder)throw new Error("media recorder is undefined.");r.mediaRecorder.addEventListener("dataavailable",e.audio)})),r.tasklist=[]})),r.mediaRecorder.start(5)})),t}return o(t,e),t.prototype.generateListeners=function(e,t,r){var n=this;return{audio:function(o){var i=new FileReader;i.readAsDataURL(o.data),i.onloadend=function(){var o=i.result;e.send(n.constructGrabPacket("audio",{audio:o}),t,r)}}}},t.prototype.generateLinkedListeners=function(e){return{audio:function(t){e(t,"audio")}}},t.prototype.addListenersFor=function(e,t,r){var n=this.generateListeners(e,t,r);return null==this.mediaRecorder?this.tasklist.push(n):this.mediaRecorder.addEventListener("dataavailable",n.audio),n},t.prototype.addLinkedListenersFor=function(e){var t=this.generateLinkedListeners(e);return null==this.mediaRecorder?this.tasklist.push(t):this.mediaRecorder.addEventListener("dataavailable",t.audio),t},t.prototype.removeListeners=function(e){null!=this.mediaRecorder&&this.mediaRecorder.removeEventListener("dataavailable",e.audio)},t.isEvent=function(e){return i.Grabber.isGrabberEvent(e)&&"audio"==e.__grabbertype},t}(i.Grabber);t.AudioGrabber=a},543:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioGrabber=t.KeyboardGrabber=t.Grabber=t.API_GRABBER_HEADER_KEY=void 0,t.API_GRABBER_HEADER_KEY="__grabber";var n=function(){function e(){this.eventCache={}}return e.prototype.sendTo=function(e,t,r){void 0===t&&(t=""),void 0===r&&(r="");var n=t+r+String(e.id);this.eventCache[n]=this.addListenersFor(e,t,r)},e.prototype.stopSendingTo=function(e,t,r){void 0===t&&(t=""),void 0===r&&(r="");var n=t+r+String(e.id);if(!(n in this.eventCache))throw new Error("Could not stop sending to YodelSocket because sending was never initiated.");this.removeListeners(this.eventCache[n]),delete this.eventCache[n]},e.prototype.linkTo=function(e){var t;if(""==e.name||"anonymous"==e.name)throw new Error("Could not add anonymous function as ListenCollector because it must be unlinked later. (Try using a named function instead).");t=e.name,this.eventCache[t]=this.addLinkedListenersFor(e)},e.prototype.unlinkFrom=function(e){var t=e.name;if(!(t in this.eventCache))throw new Error("Could not remove ListenCollector because it was never added. (Try adding this listener first).");this.removeListeners(this.eventCache[t]),delete this.eventCache[t]},e.prototype.isSendingTo=function(e,t,r){return void 0===t&&(t=""),void 0===r&&(r=""),t+r+String(e.id)in this.eventCache},e.prototype.isLinkedTo=function(e){return e.name in this.eventCache},e.prototype.constructGrabPacket=function(e,t){return t.__grabbertype=e,t},e.isGrabberEvent=function(e){return null!=e.__grabbertype},e}();t.Grabber=n;var o=r(883);Object.defineProperty(t,"KeyboardGrabber",{enumerable:!0,get:function(){return o.KeyboardGrabber}});var i=r(324);Object.defineProperty(t,"AudioGrabber",{enumerable:!0,get:function(){return i.AudioGrabber}})},883:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardGrabber=void 0;var i=r(543),a=function(e){function t(t){void 0===t&&(t=document);var r=e.call(this)||this;return r.sourceElement=document,r.sourceElement=t,r}return o(t,e),t.prototype.generateListeners=function(e,t,r){var n=this;return{keydown:function(o){e.send(n.constructGrabPacket("keyboard",{code:o.code,key:o.key,type:"keydown"}),t,r)},keyup:function(o){e.send(n.constructGrabPacket("keyboard",{code:o.code,key:o.key,type:"keyup"}),t,r)}}},t.prototype.generateLinkedListeners=function(e){return{keydown:function(t){e(t,"keydown")},keyup:function(t){e(t,"keyup")}}},t.prototype.addListenersFor=function(e,t,r){var n=this.generateListeners(e,t,r);return this.sourceElement.addEventListener("keydown",n.keydown),this.sourceElement.addEventListener("keyup",n.keyup),n},t.prototype.addLinkedListenersFor=function(e){var t=this.generateLinkedListeners(e);return this.sourceElement.addEventListener("keydown",t.keydown),this.sourceElement.addEventListener("keyup",t.keyup),t},t.prototype.removeListeners=function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var r=e[t];this.sourceElement.removeEventListener(t,r)}},t.isEvent=function(e){return i.Grabber.isGrabberEvent(e)&&"keyboard"==e.__grabbertype},t}(i.Grabber);t.KeyboardGrabber=a},491:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Section=void 0;t.Section=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r=""),this.fields={},this.payload="",this.format=e,this.fields=t,this.payload=r}}},t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}var n={};(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.AudioGrabber=e.KeyboardGrabber=e.Grabber=e.Format=e.Section=e.Field=e.FieldType=e.APIConnectionError=e.YodelError=e.UnkownGroup=e.InvalidFieldArgs=e.YodelSocket=void 0;var t=r(787),o=r(491),i=r(909),a="__yodelapidecode",s=new i.Format([],1);s.mtype=-127;var c=function(){function e(e,t){this.action="",this.kwargs={},this.action=e,this.kwargs=t}return e.prototype.stringify=function(){return JSON.stringify(this)},e}(),u=function(){function e(t){this._name="",this.groups=[],this.onmessage=null,this.messageStack=[],this._relay=!1,this.id=e.idcounter,this.hostip=t,this._channel=0,this.directSock=new WebSocket(this.hostip);var r=this;this.directSock.addEventListener("message",(function(e){!function(e,t){var r,n=JSON.parse(t.data);if("incoming"==n.action){if("fields"in n.kwargs)r=new o.Section(new i.Format(n.kwargs.fields,n.kwargs.number),n.kwargs.fields,n.kwargs.payload);else{if(!("payload"in n.kwargs))throw new Error("Invalid Section data received: "+n);if(n.kwargs.payload.startsWith(a)){var u=n.kwargs.payload.slice(a.length),d=JSON.parse(u);r=new o.Section(s,d,u)}else r=new o.Section(s,{payload:n.kwargs.string},n.kwargs.string)}null!=e.onmessage?e.onmessage(r):e.messageStack.push(r)}else if("error"==n.action)throw new c(n.kwargs.message,n.kwargs.name)}(r,e)})),e.idcounter++}return e.prototype.setOnConnect=function(e){this.directSock.onopen=e},e.prototype.setOnMessage=function(e){this.onmessage=e,this.messageStack.forEach((function(t){e(t)}))},e.prototype.sendNewFormat=function(e){this.sendRawMessage(new c("createFormat",e))},e.prototype.send=function(e,t,r){void 0===t&&(t=""),void 0===r&&(r="");var n="Basic";e instanceof o.Section?(n="Section",this.sendNewFormat(e.format)):e instanceof Blob?e.text().then((function(t){e=t})):e instanceof String||(e=a+JSON.stringify(e)),this.sendRawMessage(new c("send"+n,{payload:e,name:t,group:r}))},e.prototype.joinGroup=function(e){-1==this.groups.indexOf(e)&&(this.sendRawMessage(new c("joinGroup",{group:e})),this.groups.push(e))},e.prototype.leaveGroup=function(e){var r=this.groups.indexOf(e);if(-1==r)throw new t.UnkownGroup(e);this.sendRawMessage(new c("leaveGroup",{group:e})),this.groups.splice(r,1)},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){e!=this._name&&(this._name=e,this.sendRawMessage(new c("setName",{name:e})))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relay",{get:function(){return this._relay},set:function(e){e!=this._relay&&(this._relay=e,this.sendRawMessage(new c("toggleRelay",{relay:e})))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},set:function(e){e!=this._channel&&(this.sendRawMessage(new c("setChannel",{channel:e})),this._channel=e)},enumerable:!1,configurable:!0}),e.prototype.sendRawMessage=function(e){if(this.directSock.readyState!=WebSocket.OPEN)throw new t.APIConnectionError(this.directSock.readyState);var r=e.stringify();this.directSock.send(r)},e.idcounter=0,e}();e.YodelSocket=u;var d=r(787);Object.defineProperty(e,"InvalidFieldArgs",{enumerable:!0,get:function(){return d.InvalidFieldArgs}}),Object.defineProperty(e,"UnkownGroup",{enumerable:!0,get:function(){return d.UnkownGroup}}),Object.defineProperty(e,"YodelError",{enumerable:!0,get:function(){return d.YodelError}}),Object.defineProperty(e,"APIConnectionError",{enumerable:!0,get:function(){return d.APIConnectionError}});var l=r(462);Object.defineProperty(e,"FieldType",{enumerable:!0,get:function(){return l.FieldType}}),Object.defineProperty(e,"Field",{enumerable:!0,get:function(){return l.Field}});var p=r(491);Object.defineProperty(e,"Section",{enumerable:!0,get:function(){return p.Section}});var f=r(909);Object.defineProperty(e,"Format",{enumerable:!0,get:function(){return f.Format}});var h=r(543);Object.defineProperty(e,"Grabber",{enumerable:!0,get:function(){return h.Grabber}}),Object.defineProperty(e,"KeyboardGrabber",{enumerable:!0,get:function(){return h.KeyboardGrabber}}),Object.defineProperty(e,"AudioGrabber",{enumerable:!0,get:function(){return h.AudioGrabber}})})(),yodel=n})();
//# sourceMappingURL=yodel.js.map